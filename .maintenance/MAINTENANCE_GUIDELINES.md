# .maintenance - 「メンテして」ガイドライン

「メンテして」と言われたら、このガイドに基づいて自動的に点検・改善を実行します。

## 事前確認事項

メンテナンスを開始する前に、.maintenanceディレクトリ内の関連ドキュメントを確認します：

- **INDEX.md** - ドキュメント全体の構成と各ファイルの役割を確認
- **README.md** - システムアーキテクチャや基本構成を理解
- **MAINTENANCE_PROCEDURES.md** - 詳細な手順や標準的な作業フローを参照
- **COMPONENT_DETAILS.md** - 各コンポーネントの仕様や依存関係を把握
- **QUICK_REFERENCE.md** - よくある問題や即座に必要な情報を確認
- **その他のドキュメント** - プロジェクト固有の情報やカスタム手順を確認

※ 上記ファイルが存在しない場合は、利用可能なドキュメントのみを参照します。

## メンテナンスフロー

### 📚 Phase 0: ドキュメント確認（2-3分）
1. **.maintenanceディレクトリの確認**
   - [ ] ディレクトリの存在確認
   - [ ] 利用可能なドキュメントのリスト化
   - [ ] プロジェクト固有の手順やガイドラインの確認

2. **関連情報の収集**
   - [ ] システムアーキテクチャの理解（README.mdなど）
   - [ ] コンポーネント構成の把握（COMPONENT_DETAILS.mdなど）
   - [ ] 既知の問題や注意事項の確認（QUICK_REFERENCE.mdなど）

### 🔍 Phase 1: 点検（5分）
1. **構成チェック** - プロジェクトアーキテクチャに基づく
   - [ ] ファイル構成の確認
   - [ ] パフォーマンスボトルネックの特定
   - [ ] セキュリティリスクの検出

2. **コード品質チェック**
   - [ ] 重複コードの検出
   - [ ] 複雑度の測定
   - [ ] 型安全性・静的解析の確認

3. **依存関係チェック**
   - [ ] 古いパッケージ
   - [ ] 脆弱性のあるパッケージ
   - [ ] 未使用の依存関係

### 🔧 Phase 2: 改善（10-30分）
1. **即効改善**
   - [ ] 自動修正可能な問題の対処
   - [ ] 簡単なリファクタリング
   - [ ] 型定義・ドキュメントの追加

2. **構造改善**
   - [ ] モジュール・コンポーネント分割
   - [ ] 重複コード統合
   - [ ] パフォーマンス最適化

### 📊 Phase 3: レポート（5分）
標準レポートテンプレートに基づいて結果を報告

## クイックコマンド解釈

### 「メンテして」のバリエーション

| コマンド | 実行内容 |
|---------|---------|
| メンテして | フルメンテナンス（点検＋改善） |
| 軽くメンテ | Phase 1のみ（点検のみ） |
| しっかりメンテ | Phase 1-3すべて実行 |
| メンテ確認 | 点検のみ、改善提案付き |
| 急ぎメンテ | 即効改善のみ実行 |

### 範囲指定のバリエーション

| コマンド | 実行内容 |
|---------|---------|
| src/メンテして | src/ディレクトリのみ |
| コンポーネントメンテ | UIコンポーネントのみ |
| 全体メンテ | プロジェクト全体 |

## 自動判定ロジック

「メンテして」と言われたら、以下を自動判定：

1. **.maintenanceディレクトリの確認**
   - 存在する場合 → 関連ドキュメントを参照してプロジェクト固有の手順を優先
   - 存在しない場合 → 本ガイドラインの汎用手順に従う

2. **対象範囲**
   - 指定なし → 最近変更されたファイル中心
   - ディレクトリ指定 → その範囲のみ
   - 「全体」 → プロジェクト全体

3. **深度**
   - 「軽く」 → 表面的なチェックのみ（Phase 0-1）
   - 「しっかり」 → 詳細な分析と改善（Phase 0-3すべて）
   - 指定なし → 標準レベル（Phase 0-2）

4. **優先順位**
   - ドキュメントで指定された優先順位 → 最優先
   - パフォーマンス影響大 → 高優先
   - セキュリティリスク → 高優先
   - コード品質 → 通常優先度

## プロジェクトタイプ別メンテナンスポイント

### 1. Webアプリケーション
- **フロントエンド**
  - [ ] バンドルサイズの確認
  - [ ] 画像・アセット最適化
  - [ ] パフォーマンス指標（Core Web Vitals）
  - [ ] アクセシビリティチェック

- **バックエンド**
  - [ ] API応答時間の測定
  - [ ] データベースクエリの最適化
  - [ ] キャッシュ戦略の確認
  - [ ] エラーハンドリング

### 2. CLIツール・スクリプト
- **実行ファイル**
  - [ ] 引数パースの堅牢性
  - [ ] エラーメッセージの明確性
  - [ ] ヘルプメッセージの充実
  - [ ] 終了コードの適切性

### 3. ライブラリ・パッケージ
- **API設計**
  - [ ] 後方互換性の確認
  - [ ] ドキュメントの充実度
  - [ ] 型定義の完全性
  - [ ] テストカバレッジ

### 4. デスクトップアプリケーション
- **パフォーマンス**
  - [ ] メモリリークの検出
  - [ ] 起動時間の最適化
  - [ ] リソース使用量の確認
  - [ ] クラッシュレポートの分析

### 5. モバイルアプリケーション
- **最適化**
  - [ ] バッテリー消費の確認
  - [ ] ネットワーク使用量
  - [ ] オフライン対応
  - [ ] デバイス互換性

### 6. API・マイクロサービス
- **信頼性**
  - [ ] エンドポイントの応答確認
  - [ ] レート制限の実装
  - [ ] 認証・認可の確認
  - [ ] ログ・トレーシング

## 言語別チェックポイント

### JavaScript/TypeScript
- **品質チェック**
  - [ ] ESLint/TSLintエラー
  - [ ] 型定義の完全性
  - [ ] 未使用の変数・インポート
  - [ ] 非同期処理の適切性

### Python
- **コード品質**
  - [ ] PEP 8準拠
  - [ ] 型ヒントの使用
  - [ ] docstringの記述
  - [ ] 例外処理の適切性

### Go
- **最適化**
  - [ ] goroutineリーク
  - [ ] メモリアロケーション
  - [ ] エラーハンドリング
  - [ ] テストカバレッジ

### Java
- **パフォーマンス**
  - [ ] メモリ使用量
  - [ ] GCの頻度
  - [ ] スレッドセーフティ
  - [ ] リソースリーク

### Rust
- **安全性**
  - [ ] unsafe使用箇所
  - [ ] 所有権の適切性
  - [ ] エラーハンドリング
  - [ ] パフォーマンス最適化

## メンテナンス結果サンプル

```markdown
## メンテナンス完了レポート

### � ドキュメント確認結果
- ✅ .maintenanceディレクトリ: 確認済み
- 📄 参照したドキュメント: INDEX.md, README.md, MAINTENANCE_PROCEDURES.md
- 💡 プロジェクト固有の手順: 3件適用

### �🔍 点検結果
- ✅ ファイル構成: 良好（README.mdの構成図に準拠）
- ⚠️ パフォーマンス: 3箇所要改善（COMPONENT_DETAILS.mdの基準に基づく）
- ✅ セキュリティ: 問題なし

### 🔧 実施した改善
1. 重複コードを統合（-120行）
2. 動的インポート追加（初期ロード-50KB）
3. 型定義追加（any撲滅率: 95%→100%）

### 💡 追加の改善提案
- 画像最適化で初期ロード時間を20%短縮可能
- バンドル分割でさらに-30KB削減可能
- QUICK_REFERENCE.mdに記載の最適化手法も検討推奨

詳細は個別ファイルのコメントを参照
```

## 設定カスタマイズ

### .maintenance/config.json (オプション)
```json
{
  "autoFix": true,
  "maxDuration": "30m",
  "priorities": ["performance", "security", "quality"],
  "exclude": ["node_modules", "dist", "build", "vendor"],
  "projectType": "web|cli|library|desktop|mobile|api",
  "languages": ["javascript", "typescript", "python", "go", "rust"],
  "tools": {
    "linter": {
      "javascript": "eslint",
      "typescript": "tslint",
      "python": "pylint",
      "go": "golint"
    },
    "formatter": {
      "javascript": "prettier",
      "python": "black",
      "go": "gofmt"
    }
  }
}
```

## 自動メンテナンスタスク

### デイリータスク
```bash
# ログローテーション（汎用）
find logs/ -name "*.log" -mtime +30 -delete 2>/dev/null || true

# エラーチェック
grep -i error logs/**/*.log 2>/dev/null | tail -20 || echo "No logs found"

# 一時ファイルのクリーンアップ
find . -name "*.tmp" -o -name "*.swp" -o -name ".DS_Store" | xargs rm -f
```

### ウィークリータスク
```bash
# 依存関係の更新確認（Node.js）
[ -f package.json ] && npm outdated

# 依存関係の更新確認（Python）
[ -f requirements.txt ] && pip list --outdated

# 依存関係の更新確認（Go）
[ -f go.mod ] && go list -u -m all

# 不要なブランチの削除
git branch --merged | grep -v "\*\|main\|master\|develop" | xargs -n 1 git branch -d 2>/dev/null || true
```

### マンスリータスク
```bash
# セキュリティ監査（Node.js）
[ -f package.json ] && npm audit

# セキュリティ監査（Python）
[ -f requirements.txt ] && pip-audit

# ディスク使用量の確認
du -sh ./* | sort -rh | head -20
```

## CI/CDパイプラインメンテナンス

### GitHub Actions
- [ ] ワークフローの実行時間確認
- [ ] 失敗率の分析
- [ ] キャッシュの有効性
- [ ] シークレットの更新

### Jenkins
- [ ] ジョブの実行履歴確認
- [ ] プラグインの更新
- [ ] ワークスペースのクリーンアップ
- [ ] ノードの健全性

### GitLab CI
- [ ] パイプライン効率の確認
- [ ] ランナーの使用状況
- [ ] アーティファクトの管理
- [ ] 変数・シークレットの確認

## コンテナ環境メンテナンス

### Docker
- [ ] 未使用イメージの削除
- [ ] コンテナログのローテーション
- [ ] ボリュームの使用状況
- [ ] ネットワーク設定の確認

### Kubernetes
- [ ] Pod の健全性チェック
- [ ] リソース使用量の確認
- [ ] 古いDeploymentの削除
- [ ] ConfigMap/Secretの更新

## クラウド環境メンテナンス

### AWS
- [ ] 未使用リソースの確認
- [ ] コスト最適化の機会
- [ ] セキュリティグループの監査
- [ ] バックアップの確認

### Azure
- [ ] リソースグループの整理
- [ ] コスト分析
- [ ] アクセス権限の確認
- [ ] 監視アラートの設定

### GCP
- [ ] プロジェクトの整理
- [ ] 課金アラートの確認
- [ ] IAMポリシーの監査
- [ ] ログの保持期間

## チーム固有ルール

### コーディング規約
- 各言語の標準的なスタイルガイドに従う
- プロジェクト固有の規約は `.editorconfig` や `linter` 設定で定義

### コミット規約
- feat: 新機能
- fix: バグ修正
- docs: ドキュメント更新
- style: コードスタイルの変更
- refactor: リファクタリング
- test: テスト追加・修正
- chore: ビルドプロセスや補助ツールの変更

### レビュー観点
- [ ] エラーハンドリングは適切か
- [ ] ログ出力は十分か
- [ ] セキュリティリスクはないか
- [ ] パフォーマンスへの影響は許容範囲か
- [ ] テストは十分か
- [ ] ドキュメントは更新されているか

---

「メンテして」の一言で、プロジェクトに応じた適切な点検と改善を実行します。
