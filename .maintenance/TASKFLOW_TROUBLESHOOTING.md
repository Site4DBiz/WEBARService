# ClaudeCodeTaskRunner トラブルシューティングガイド

## NVM環境での問題

### 問題: Claudeコマンドが見つからない
**エラーメッセージ**: 
```
env: node: No such file or directory
```

**原因**:
- ビルドされたアプリケーションではシェルの環境変数が読み込まれない
- NVMの環境変数（`NVM_BIN`など）が設定されていない
- PATHに`node`コマンドが含まれていない

**解決方法**:

#### 1. Claudeパスの手動設定
1. ClaudeCodeTaskRunnerを開く
2. 設定タブ → AI設定セクション
3. 「Claudeコマンドのパス」フィールドに直接パスを入力
   - 例: `/Users/username/.nvm/versions/node/v20.11.1/bin/claude`

#### 2. パスの確認方法
ターミナルで以下のコマンドを実行：
```bash
which claude
```

#### 3. テスト機能の使用
1. パスを入力後「テスト」ボタンをクリック
2. 成功すればバージョン情報が表示される
3. エラーが出た場合は、エラーメッセージを確認

#### 4. 診断機能で確認
1. 実行タブの進捗エリアで「診断」ボタンをクリック
2. 診断結果のnvmInfoセクションを確認：
   - `NVM_DIR`: NVMのディレクトリ
   - `nvmDirExists`: NVMディレクトリの存在確認
   - `nvmVersionsFound`: インストール済みのNode.jsバージョン

### よくあるNVMパスの例
- macOS (Intel): `/Users/username/.nvm/versions/node/vXX.X.X/bin/claude`
- macOS (M1/M2): `/Users/username/.nvm/versions/node/vXX.X.X/bin/claude`
- Linux: `/home/username/.nvm/versions/node/vXX.X.X/bin/claude`

## その他の一般的な問題

### 問題: 進捗が表示されない（別マシンでの実行時）
**症状**:
- 「進捗データがありません」の表示から変わらない
- Claudeパスのテストは成功している

**原因**:
- 作業ディレクトリが正しく設定されていない
- クロスプラットフォーム非対応のパス使用

**解決法**:
1. 最新バージョンにアップデート（2025-08-05以降）
2. 診断機能を実行して詳細を確認
3. ログファイルで作業ディレクトリを確認
4. 進捗エリアのデバッグ情報を確認：
   - 作業ディレクトリが正しいか
   - 一時ファイルのパスが適切か

### 問題: プロジェクトフォルダが選択できない
**解決法**:
1. アプリを完全に終了して再起動
2. フォルダに適切なアクセス権限があることを確認
3. macOSの場合、システム環境設定でアプリにフォルダアクセスを許可

### 問題: スケジューラーが動作しない
**解決法**:
1. 設定タブで以下を確認：
   - 実行時間が正しく設定されている
   - プロジェクトパスが設定されている
   - 「起動時に自動開始」が有効（必要な場合）
2. `combined.log`でエラーを確認

### 問題: AI実行が失敗する
**解決法**:
1. 選択したコントローラー（Claude Code）が正しいか確認
2. プロジェクトパスが正しいか確認
3. `tasks/todo.md`ファイルの形式を確認：
   ```markdown
   - [ ] タスクの説明
   ```

### 問題: 進捗が表示されない
**解決法**:
1. 実行タブの進捗エリアを確認
2. エラーメッセージが表示されていないか確認
3. ログファイルを確認：
   - `~/TaskFlow/logs/claude-code/[日付]/task_*.log`

## ログファイルの場所

### アプリケーションログ
- **メインログ**: `combined.log`（プロジェクトルート）
- **エラーログ**: `error.log`（プロジェクトルート）

### Claude Code実行ログ
- **場所**: `~/ClaudeCodeTaskRunner/logs/claude-code/[日付]/`
- **タスクログ**: `task_YYYYMMDD_HHMMSS.log`
- **サマリーログ**: `summary.log`

## デバッグ情報の収集

### 開発者モードでの起動
```bash
npm run dev
```

### 詳細なログを有効にする
1. 開発者ツールを開く（Cmd+Option+I または Ctrl+Shift+I）
2. Consoleタブでエラーを確認

### 診断情報のエクスポート
1. 実行タブの「診断」ボタンをクリック
2. 表示された情報をコピー
3. サポートへの問い合わせ時に添付

## よくある質問

### Q: NVM以外の方法でインストールしたClaudeも使えますか？
A: はい、使えます。Homebrewや公式インストーラーでインストールした場合は、通常自動的に検出されます。

### Q: 複数のNode.jsバージョンを使い分けることはできますか？
A: 現在は、設定したClaudeパスに対応するNode.jsバージョンが使用されます。プロジェクトごとに異なるバージョンを使用する場合は、都度パスを変更する必要があります。

### Q: Windowsでも動作しますか？
A: 基本的な機能は動作しますが、NVM for Windowsを使用している場合は、パスの形式が異なることに注意してください（例：`C:\Users\username\AppData\Roaming\nvm\vXX.X.X\claude.cmd`）。

## 診断機能実行時のエラー

### 問題: Cannot read properties of undefined (reading 'SHELL')
**症状**:
- 診断機能実行時に上記エラーが発生
- 別マシンで特に発生しやすい

**原因**:
- enhanced-diagnostics.js内で変数名の衝突が発生
- ローカル変数がグローバルオブジェクトを隠してしまう

**解決法**:
1. 最新バージョン（v0.4.3以降）にアップデート
2. 手動修正が必要な場合：
   - `enhanced-diagnostics.js`の`diagnoseProcessExecution`メソッド内
   - 変数名`process`を`processInfo`に変更

## サポート

問題が解決しない場合は、以下の情報を添えてサポートにお問い合わせください：
- エラーメッセージの全文
- 診断結果の内容
- 使用しているOS
- Node.jsのバージョン
- Claudeのインストール方法（NVM、Homebrew、公式インストーラーなど）

最終更新: 2025-08-05
